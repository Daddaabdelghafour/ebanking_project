<!-- Page header -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
    <div class="flex justify-between items-center">
        <div>
            <h2 class="text-2xl font-bold text-gray-800">Virements
                Bancaires</h2>
            <p class="text-gray-600">Effectuez des virements rapides et
                sécurisés vers vos bénéficiaires</p>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Transfer form - Left column on large screens, full width on small -->
    <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-4">Nouveau Virement</h3>

                <form [formGroup]="transferForm" (ngSubmit)="submitTransfer()">
                    <!-- Beneficiary Selection -->
                    <div class="mb-5">
                        <label
                            class="block text-sm font-medium text-gray-700 mb-1">
                            Bénéficiaire
                        </label>
                        <div class="relative">
                            <div
                                (click)="toggleBeneficiaryList()"
                                class="w-full border rounded-lg p-3 cursor-pointer hover:border-blue-500 flex justify-between items-center">
                                <div class="flex items-center">
                                    <div
                                        *ngIf="selectedBeneficiary; else noBeneficiary">
                                        <div class="flex items-center">
                                            <div
                                                class="h-10 w-10 rounded-full flex items-center justify-center text-white"
                                                [ngClass]="selectedBeneficiary.iconColor">
                                                {{
                                                getBeneficiaryInitials(selectedBeneficiary.name)
                                                }}
                                            </div>
                                            <div class="ml-3">
                                                <div class="font-medium">{{
                                                    selectedBeneficiary.name
                                                    }}</div>
                                                <div
                                                    class="text-xs text-gray-500">{{
                                                    selectedBeneficiary.bank
                                                    }}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <ng-template #noBeneficiary>
                                        <div class="text-gray-500">Sélectionnez
                                            un bénéficiaire</div>
                                    </ng-template>
                                </div>
                                <i
                                    class="fa-solid fa-chevron-down text-gray-400"></i>
                            </div>

                            <!-- Beneficiary dropdown list -->
                            <div *ngIf="showBeneficiaryList"
                                class="absolute z-10 mt-1 w-full bg-white shadow-lg rounded-lg border overflow-hidden">
                                <div class="p-2 border-b">
                                    <div class="relative">
                                        <input type="text"
                                            placeholder="Rechercher un bénéficiaire..."
                                            class="w-full p-2 pl-9 border rounded">
                                        <i
                                            class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                                <div class="max-h-60 overflow-y-auto">
                                    <div *ngFor="let ben of beneficiaries"
                                        (click)="selectBeneficiary(ben)"
                                        class="p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0"
                                        [class.border-blue-600]="selectedBeneficiary?.id === ben.id"
                                        [class.bg-blue-50]="selectedBeneficiary?.id === ben.id">
                                        <div class="flex items-center">
                                            <div
                                                class="h-10 w-10 rounded-full flex items-center justify-center text-white"
                                                [ngClass]="ben.iconColor">
                                                {{
                                                getBeneficiaryInitials(ben.name)
                                                }}
                                            </div>
                                            <div class="ml-3">
                                                <div class="font-medium">{{
                                                    ben.name }}</div>
                                                <div
                                                    class="text-xs flex items-center justify-between">
                                                    <span
                                                        class="text-gray-500">{{
                                                        ben.bank }}</span>
                                                    <span
                                                        *ngIf="selectedBeneficiary?.id === ben.id"
                                                        class="ml-2 text-blue-600">
                                                        <i
                                                            class="fa-solid fa-check"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="p-2 border-t">
                                    <button type="button"
                                        class="w-full p-2 text-center text-blue-600 hover:bg-blue-50 rounded">
                                        <i class="fa-solid fa-plus mr-1"></i>
                                        Ajouter un bénéficiaire
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div
                            *ngIf="transferForm.get('beneficiaryId')?.invalid && transferForm.get('beneficiaryId')?.touched"
                            class="mt-1 text-sm text-red-600">
                            Veuillez sélectionner un bénéficiaire
                        </div>
                    </div>

                    <!-- Amount -->
                    <div class="mb-5">
                        <label for="amount"
                            class="block text-sm font-medium text-gray-700 mb-1">
                            Montant
                        </label>
                        <div class="relative">
                            <div
                                class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500">MAD</span>
                            </div>
                            <input
                                type="number"
                                id="amount"
                                formControlName="amount"
                                placeholder="0.00"
                                class="block w-full pl-12 pr-12 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div
                            *ngIf="transferForm.get('amount')?.invalid && transferForm.get('amount')?.touched"
                            class="mt-1 text-sm text-red-600">
                            <span
                                *ngIf="transferForm.get('amount')?.errors?.['required']">Le
                                montant est requis</span>
                            <span
                                *ngIf="transferForm.get('amount')?.errors?.['min']">Le
                                montant minimum est 1 MAD</span>
                        </div>
                    </div>

                    <!-- Purpose -->
                    <div class="mb-5">
                        <label for="purpose"
                            class="block text-sm font-medium text-gray-700 mb-1">
                            Motif de virement (optionnel)
                        </label>
                        <select
                            id="purpose"
                            formControlName="purpose"
                            class="block w-full py-2 px-3 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <option value>Sélectionner un motif</option>
                            <option value="Loyer">Loyer</option>
                            <option value="Facture">Facture</option>
                            <option value="Remboursement">Remboursement</option>
                            <option value="Salaire">Salaire</option>
                            <option value="Divers">Divers</option>
                        </select>
                    </div>

                    <!-- Reference -->
                    <div class="mb-5">
                        <label for="reference"
                            class="block text-sm font-medium text-gray-700 mb-1">
                            Référence (optionnel)
                        </label>
                        <input
                            type="text"
                            id="reference"
                            formControlName="reference"
                            placeholder="Référence de votre virement"
                            class="block w-full py-2 px-3 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- Submit button -->
                    <div class="mt-6">
                        <button
                            type="submit"
                            [disabled]="transferForm.invalid"
                            class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            Effectuer le virement
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Transaction History - Right column on large screens -->
    <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">Historique des virements</h3>
            </div>

            <!-- Transaction list -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bénéficiaire</th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motif</th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                            <th
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Référence</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr *ngFor="let transfer of transfers"
                            class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                {{ transfer.date | date:'dd/MM/yyyy' }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium">{{
                                    transfer.recipient }}</div>
                                <div class="text-xs text-gray-500">{{
                                    transfer.recipientAccount }}</div>
                            </td>
                            <td
                                class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                {{ transfer.amount |
                                currency:'MAD':'symbol':'1.2-2' }}
                            </td>
                            <td
                                class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ transfer.purpose || 'N/A' }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    [ngClass]="getStatusClass(transfer.status)"
                                    class="px-2 py-1 inline-flex text-xs leading-5 font-medium rounded-full">
                                    {{ transfer.status === 'completed' ?
                                    'Complété' :
                                    transfer.status === 'pending' ? 'En cours' :
                                    'Échoué' }}
                                </span>
                            </td>
                            <td
                                class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ transfer.reference }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="px-6 py-4 flex items-center justify-between border-t">
                <div class="text-sm text-gray-500">
                    Affichage de <span class="font-medium">1</span> à <span
                        class="font-medium">{{ transfers.length }}</span> sur
                    <span class="font-medium">{{ transfers.length }}</span>
                    virements
                </div>
                <div class="flex-1 flex justify-end">
                    <nav class="relative z-0 inline-flex shadow-sm -space-x-px"
                        aria-label="Pagination">
                        <a href="#"
                            class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Previous</span>
                            <i class="fa-solid fa-chevron-left"></i>
                        </a>
                        <a href="#"
                            class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">1</a>
                        <a href="#"
                            class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">2</a>
                        <a href="#"
                            class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Next</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation modal -->
<div *ngIf="showConfirmation" class="fixed inset-0 overflow-y-auto z-50"
    aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div
        class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
            aria-hidden="true"></div>

        <!-- Modal panel -->
        <div
            class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div
                        class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                        <i class="fa-solid fa-check text-green-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900"
                            id="modal-title">
                            Virement en cours de traitement
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Votre virement vers {{
                                getSelectedBeneficiary()?.name }} d'un montant
                                de {{ transferForm.get('amount')?.value |
                                currency:'MAD':'symbol':'1.2-2' }} est en cours
                                de traitement. Vous pouvez suivre son statut
                                dans l'historique des virements.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button
                    type="button"
                    (click)="closeConfirmation()"
                    class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                    Fermer
                </button>
            </div>
        </div>
    </div>
</div>