<div class="container mx-auto px-4 py-8">
    <!-- En-tête -->
    <div
        class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Mes comptes</h1>
            <p class="text-gray-600">Gérez vos comptes bancaires et effectuez
                des transferts</p>
        </div>

        <div class="mt-4 md:mt-0 flex flex-wrap gap-2">
            <button
                (click)="toggleNewAccountForm()"
                class="px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 flex items-center">
                <i class="fa-solid fa-plus mr-2"></i>
                Nouveau compte
            </button>

            <button
                (click)="toggleQuickTransferForm()"
                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center">
                <i class="fa-solid fa-right-left mr-2"></i>
                Transfert rapide
            </button>
        </div>
    </div>

    <!-- Indicateur de chargement -->
    <div *ngIf="isLoading" class="flex justify-center py-10">
        <div
            class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-teal-500"></div>
    </div>

    <!-- Message d'erreur -->
    <div *ngIf="!isLoading && errorMessage"
        class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6">
        <div class="flex items-center">
            <i class="fa-solid fa-circle-exclamation mr-2"></i>
            <p>{{ errorMessage }}</p>
        </div>
    </div>

    <!-- Récapitulatif des comptes -->
    <div *ngIf="!isLoading && accounts.length > 0" class="mb-8">
        <div
            class="bg-gradient-to-r from-teal-500 to-blue-500 rounded-lg px-6 py-8 shadow-lg text-white">
            <div
                class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h2 class="text-lg font-medium opacity-90">Solde total</h2>
                    <p class="text-3xl font-bold">{{
                        formatCurrency(totalBalance, selectedCurrency) }}</p>
                </div>

                <div class="mt-4 md:mt-0">
                    <div class="inline-flex rounded-md shadow-sm">
                        <button
                            *ngFor="let currency of ['MAD', 'EUR', 'USD']"
                            (click)="changeCurrency(currency)"
                            [class.bg-white]="selectedCurrency === currency"
                            [class.text-blue-600]="selectedCurrency === currency"
                            [class.bg-transparent]="selectedCurrency !== currency"
                            class="px-3 py-1.5 text-sm font-medium border border-white first:rounded-l-md last:rounded-r-md">
                            {{ currency }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nouveau compte (Modal) -->
    <div *ngIf="showNewAccountForm"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Nouveau
                        compte</h3>
                    <button (click)="toggleNewAccountForm()"
                        class="text-gray-400 hover:text-gray-500">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <!-- Type de compte -->
                    <div>
                        <label for="account-type"
                            class="block text-sm font-medium text-gray-700 mb-1">Type
                            de compte</label>
                        <select
                            id="account-type"
                            [(ngModel)]="newAccountData.type"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                            <option value="current">Compte courant</option>
                            <option value="savings">Compte épargne</option>
                            <option value="investment">Compte
                                d'investissement</option>
                            <option value="fixed">Dépôt à terme</option>
                            <option value="other">Autre</option>
                        </select>
                    </div>

                    <!-- Devise -->
                    <div>
                        <label for="account-currency"
                            class="block text-sm font-medium text-gray-700 mb-1">Devise</label>
                        <select
                            id="account-currency"
                            [(ngModel)]="newAccountData.currency"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                            <option value="MAD">MAD - Dirham marocain</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="USD">USD - Dollar américain</option>
                            <option value="GBP">GBP - Livre sterling</option>
                        </select>
                    </div>

                    <!-- Dépôt initial -->
                    <div>
                        <label for="initial-deposit"
                            class="block text-sm font-medium text-gray-700 mb-1">Dépôt
                            initial (facultatif)</label>
                        <input
                            type="number"
                            id="initial-deposit"
                            [(ngModel)]="newAccountData.initialDeposit"
                            min="0"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>

                <div class="mt-6">
                    <button
                        (click)="createNewAccount()"
                        [disabled]="isCreatingAccount"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 disabled:bg-gray-300 disabled:cursor-not-allowed">
                        <span *ngIf="isCreatingAccount"
                            class="inline-block mr-2">
                            <i class="fa-solid fa-spinner fa-spin"></i>
                        </span>
                        {{ isCreatingAccount ? 'Création en cours...' :
                        'Créer le compte' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfert rapide (Modal) -->
    <div *ngIf="showQuickTransferForm"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Transfert
                        rapide</h3>
                    <button (click)="toggleQuickTransferForm()"
                        class="text-gray-400 hover:text-gray-500">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <!-- Message de succès -->
                <div *ngIf="transferSuccess"
                    class="mb-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4">
                    <div class="flex">
                        <i class="fa-solid fa-check-circle mr-2"></i>
                        <p>Transfert effectué avec succès!</p>
                    </div>
                </div>

                <!-- Message d'erreur -->
                <div *ngIf="errorMessage"
                    class="mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4">
                    <div class="flex">
                        <i class="fa-solid fa-circle-exclamation mr-2"></i>
                        <p>{{ errorMessage }}</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <!-- Compte source -->
                    <div>
                        <label for="source-account"
                            class="block text-sm font-medium text-gray-700 mb-1">Compte
                            source</label>
                        <select
                            id="source-account"
                            [(ngModel)]="quickTransfer.sourceAccountId"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                            <option *ngFor="let account of accounts"
                                [value]="account.id">
                                {{ account.accountNumber }} ({{
                                formatCurrency(account.balance,
                                account.currency) }})
                            </option>
                        </select>
                    </div>

                    <!-- Compte destination -->
                    <div>
                        <label for="destination-account"
                            class="block text-sm font-medium text-gray-700 mb-1">Compte
                            destination</label>
                        <select
                            id="destination-account"
                            [(ngModel)]="quickTransfer.destinationAccountId"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                            <option value>Sélectionnez un compte</option>
                            <option *ngFor="let account of accounts"
                                [value]="account.id"
                                [disabled]="account.id === quickTransfer.sourceAccountId">
                                {{ account.accountNumber }} ({{
                                getAccountTypeLabel(account.type) }})
                            </option>
                        </select>
                    </div>

                    <!-- Montant -->
                    <div>
                        <label for="transfer-amount"
                            class="block text-sm font-medium text-gray-700 mb-1">Montant</label>
                        <input
                            type="number"
                            id="transfer-amount"
                            [(ngModel)]="quickTransfer.amount"
                            min="0"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="transfer-desc"
                            class="block text-sm font-medium text-gray-700 mb-1">Description
                            (facultatif)</label>
                        <input
                            type="text"
                            id="transfer-desc"
                            [(ngModel)]="quickTransfer.description"
                            placeholder="Raison du transfert"
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>

                <div class="mt-6">
                    <button
                        (click)="performQuickTransfer()"
                        [disabled]="isTransferring || transferSuccess"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed">
                        <span *ngIf="isTransferring" class="inline-block mr-2">
                            <i class="fa-solid fa-spinner fa-spin"></i>
                        </span>
                        {{ isTransferring ? 'Transfert en cours...' :
                        'Effectuer le transfert' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Aucun compte -->
    <div *ngIf="!isLoading && accounts.length === 0"
        class="bg-white shadow rounded-lg p-8 text-center">
        <div class="mb-4">
            <i class="fa-solid fa-wallet text-6xl text-gray-300"></i>
        </div>
        <h2 class="text-xl font-medium text-gray-900 mb-2">Vous n'avez pas
            encore de compte</h2>
        <p class="text-gray-600 mb-6">Commencez par créer votre premier compte
            bancaire</p>
        <button
            (click)="toggleNewAccountForm()"
            class="px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500">
            Créer un compte
        </button>
    </div>

    <!-- Liste des comptes -->
    <div *ngIf="!isLoading && accounts.length > 0" class="space-y-6">
        <div *ngFor="let account of accounts"
            class="bg-white rounded-lg shadow overflow-hidden">
            <!-- En-tête de carte -->
            <div
                class="flex justify-between items-center p-4 border-b border-gray-200">
                <div class="flex items-center">
                    <div
                        class="h-10 w-10 flex items-center justify-center rounded-full"
                        [ngClass]="{'bg-blue-100 text-blue-600': account.type === 'current',
                        'bg-green-100 text-green-600': account.type === 'savings',
                        'bg-purple-100 text-purple-600': account.type === 'investment',
                        'bg-yellow-100 text-yellow-600': account.type === 'fixed',
                        'bg-gray-100 text-gray-600': account.type === 'other'}">
                        <i [class]="getAccountTypeIcon(account.type)"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-lg font-medium text-gray-900">{{
                            getAccountTypeLabel(account.type) }}</h3>
                        <p class="text-sm text-gray-600">{{
                            account.accountNumber }}</p>
                    </div>
                </div>

                <div class="text-right">
                    <span [class]="getAccountStatusClass(account.status)"
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium">
                        {{ account.status }}
                    </span>
                </div>
            </div>

            <!-- Corps de carte -->
            <div class="p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between">
                    <div class="mb-4 md:mb-0">
                        <div class="text-sm text-gray-500 mb-1">Solde
                            disponible</div>
                        <div class="flex items-baseline">
                            <span class="text-2xl font-bold text-gray-900">{{
                                formatCurrency(account.balance,
                                account.currency) }}</span>
                            <span
                                *ngIf="account.availableBalance !== undefined && account.availableBalance !== account.balance"
                                class="ml-2 text-sm text-gray-500">
                                Disponible: {{
                                formatCurrency(account.availableBalance,
                                account.currency) }}
                            </span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-500 mb-1">Date
                                d'ouverture</div>
                            <div class="text-gray-900">{{
                                formatDate(account.openedDate) }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500 mb-1">Dernière
                                opération</div>
                            <div class="text-gray-900">{{
                                formatDate(account.lastTransactionDate) }}</div>
                        </div>
                    </div>
                </div>

                <!-- Informations additionnelles -->
                <div
                    *ngIf="account.iban || account.dailyLimit || account.interestRate"
                    class="mt-6 pt-6 border-t border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div *ngIf="account.iban">
                        <div class="text-sm text-gray-500 mb-1">IBAN</div>
                        <div class="text-gray-900 font-mono text-sm">{{
                            account.iban }}</div>
                    </div>
                    <div *ngIf="account.dailyLimit">
                        <div class="text-sm text-gray-500 mb-1">Limite
                            journalière</div>
                        <div class="text-gray-900">{{
                            formatCurrency(account.dailyLimit, account.currency)
                            }}</div>
                    </div>
                    <div *ngIf="account.interestRate">
                        <div class="text-sm text-gray-500 mb-1">Taux
                            d'intérêt</div>
                        <div class="text-gray-900">{{ account.interestRate
                            }}%</div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="mt-6 flex flex-wrap gap-2">
                    <button
                        [routerLink]="['/accounts', account.id]"
                        class="px-3 py-1.5 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 flex items-center">
                        <i class="fa-solid fa-magnifying-glass mr-2"></i>
                        Détails
                    </button>
                    <button
                        (click)="downloadAccountDetails(account.id)"
                        class="px-3 py-1.5 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 flex items-center">
                        <i class="fa-solid fa-download mr-2"></i>
                        Relevé
                    </button>
                    <button
                        (click)="quickTransfer.sourceAccountId = account.id; toggleQuickTransferForm()"
                        class="px-3 py-1.5 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 flex items-center">
                        <i class="fa-solid fa-paper-plane mr-2"></i>
                        Transfert
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>