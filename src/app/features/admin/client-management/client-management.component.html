<div class="container mx-auto px-4 py-8">
    <!-- Page header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-semibold text-gray-800">Gestion des
            clients</h1>
        <button (click)="openAddModal()"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg flex items-center transition-colors">
            <i class="fas fa-plus mr-2"></i> Ajouter un client
        </button>
    </div>

    <!-- Search and filter section -->
    <div class="bg-white rounded-lg shadow-sm mb-6 p-4">
        <div class="flex flex-wrap items-center justify-between gap-4">
            <!-- Search -->
            <div class="relative flex-grow max-w-md">
                <input type="text" [(ngModel)]="filterText"
                    placeholder="Rechercher un client..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i
                    class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
            </div>

            <!-- Status filter -->
            <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-600">Statut:</span>
                <div class="inline-flex rounded-lg border border-gray-300">
                    <button (click)="filterByStatus('all')"
                        [class]="statusFilter === 'all' ? 'bg-blue-50 text-blue-600' : 'bg-white text-gray-600'"
                        class="px-3 py-1 text-sm rounded-l-lg transition-colors">
                        Tous
                    </button>
                    <button (click)="filterByStatus('active')"
                        [class]="statusFilter === 'active' ? 'bg-blue-50 text-blue-600' : 'bg-white text-gray-600'"
                        class="px-3 py-1 text-sm border-l border-r border-gray-300 transition-colors">
                        Actifs
                    </button>
                    <button (click)="filterByStatus('pending')"
                        [class]="statusFilter === 'pending' ? 'bg-blue-50 text-blue-600' : 'bg-white text-gray-600'"
                        class="px-3 py-1 text-sm border-r border-gray-300 transition-colors">
                        En attente
                    </button>
                    <button (click)="filterByStatus('inactive')"
                        [class]="statusFilter === 'inactive' ? 'bg-blue-50 text-blue-600' : 'bg-white text-gray-600'"
                        class="px-3 py-1 text-sm border-r border-gray-300 transition-colors">
                        Inactifs
                    </button>
                    <button (click)="filterByStatus('blocked')"
                        [class]="statusFilter === 'blocked' ? 'bg-blue-50 text-blue-600' : 'bg-white text-gray-600'"
                        class="px-3 py-1 text-sm rounded-r-lg transition-colors">
                        Bloqués
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoading" class="flex justify-center items-center p-10">
        <div
            class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
    </div>

    <!-- Error message -->
    <div *ngIf="error"
        class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg mb-6">
        <div class="flex items-center">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span>{{error}}</span>
        </div>
        <button (click)="loadClients()"
            class="mt-2 text-sm text-red-700 hover:text-red-900 underline">
            Réessayer
        </button>
    </div>

    <!-- Empty state -->
    <div *ngIf="!isLoading && !error && getFilteredClients().length === 0"
        class="bg-white rounded-lg shadow-sm py-8 px-4 text-center">
        <i class="fas fa-users text-gray-300 text-5xl mb-4"></i>
        <h3 class="text-lg font-medium text-gray-700 mb-2">Aucun client
            trouvé</h3>
        <p class="text-gray-500 mb-4"
            *ngIf="filterText || statusFilter !== 'all'">
            Aucun résultat ne correspond à votre recherche. Essayez de modifier
            vos filtres.
        </p>
        <p class="text-gray-500 mb-4"
            *ngIf="!filterText && statusFilter === 'all'">
            Vous n'avez pas encore de clients. Commencez par en ajouter un
            nouveau.
        </p>
        <button (click)="openAddModal()"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
            Ajouter un client
        </button>
    </div>

    <!-- Client details view -->
    <div *ngIf="isViewingDetails && selectedClient"
        class="bg-white rounded-lg shadow-sm mb-6 p-6">
        <div class="flex justify-between items-start mb-4">
            <h2 class="text-xl font-semibold text-gray-800">Détails du
                client</h2>
            <button (click)="closeDetailsView()"
                class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Personal Info -->
            <div>
                <h3 class="text-lg font-medium text-gray-700 mb-4">Informations
                    personnelles</h3>
                <div class="space-y-3">
                    <div>
                        <span class="text-sm text-gray-500">Nom complet</span>
                        <p class="font-medium">{{ getFullName(selectedClient)
                            }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Email</span>
                        <p class="font-medium">{{ selectedClient.email ||
                            'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Téléphone</span>
                        <p class="font-medium">{{ selectedClient.phoneNumber ||
                            selectedClient.phone ||
                            'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Adresse</span>
                        <p class="font-medium">{{ selectedClient.address ||
                            'Non spécifiée' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Ville</span>
                        <p class="font-medium">{{ selectedClient.city ||
                            'Non spécifiée' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Code postal</span>
                        <p class="font-medium">{{ selectedClient.postalCode ||
                            'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Pays</span>
                        <p class="font-medium">{{ selectedClient.country ||
                            'Maroc' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Date de
                            naissance</span>
                        <p class="font-medium">{{ selectedClient.birthDate ?
                            (selectedClient.birthDate | date:'dd/MM/yyyy') :
                            'Non spécifiée' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Identité</span>
                        <p class="font-medium">{{ selectedClient.identityType ||
                            'N/A' }}: {{ selectedClient.identityNumber ||
                            'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Profession</span>
                        <p class="font-medium">{{ selectedClient.occupation ||
                            'Non spécifiée' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Revenu
                            mensuel</span>
                        <p class="font-medium">{{ selectedClient.income ?
                            formatCurrency(selectedClient.income,
                            selectedClient.currency) : 'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Langue
                            préférée</span>
                        <p class="font-medium">
                            {{ selectedClient.language === 'fr' ? 'Français' :
                            (selectedClient.language === 'en' ? 'Anglais' :
                            (selectedClient.language === 'ar' ? 'Arabe' :
                            selectedClient.language || 'Non spécifiée')) }}
                        </p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Consentement
                            RGPD</span>
                        <p class="font-medium">{{ selectedClient.gdprConsent ?
                            'Accordé' : 'Non accordé' }}</p>
                    </div>
                    <div *ngIf="selectedClient.gdprConsent">
                        <span class="text-sm text-gray-500">Date du
                            consentement</span>
                        <p class="font-medium">{{ selectedClient.gdprConsentDate
                            ? (selectedClient.gdprConsentDate |
                            date:'dd/MM/yyyy HH:mm') : 'Non spécifiée' }}</p>
                    </div>
                </div>
            </div>

            <!-- Account Info -->
            <div>
                <h3 class="text-lg font-medium text-gray-700 mb-4">Informations
                    du compte</h3>
                <div class="space-y-3">
                    <div>
                        <span class="text-sm text-gray-500">ID Client</span>
                        <p class="font-medium">{{ selectedClient.clientId ||
                            selectedClient.id || 'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Type de
                            compte</span>
                        <p class="font-medium">{{ selectedClient.accountType ||
                            'Non spécifié' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Solde</span>
                        <p class="font-medium">{{
                            formatCurrency(selectedClient.balance,
                            selectedClient.currency) }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Statut</span>
                        <span
                            [class]="'inline-block px-2 py-1 text-xs font-medium rounded-full ' + getStatusClass(selectedClient.status || (selectedClient.isActive ? 'active' : 'inactive'))">
                            {{ getStatusLabel(selectedClient.status ||
                            (selectedClient.isActive ? 'active' : 'inactive'))
                            }}
                        </span>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Rôle</span>
                        <p class="font-medium">{{ selectedClient.role ||
                            'CLIENT' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Date
                            d'inscription</span>
                        <p class="font-medium">{{ (selectedClient.dateJoined ||
                            selectedClient.createdAt) ?
                            ((selectedClient.dateJoined ||
                            selectedClient.createdAt) | date:'dd/MM/yyyy') :
                            'Non spécifiée' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Date de mise à
                            jour</span>
                        <p class="font-medium">{{ selectedClient.updatedAt ?
                            (selectedClient.updatedAt | date:'dd/MM/yyyy HH:mm')
                            : 'Non spécifiée' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Dernière
                            connexion</span>
                        <p class="font-medium">{{ selectedClient.lastLogin ?
                            (selectedClient.lastLogin | date:'dd/MM/yyyy HH:mm')
                            : 'Jamais' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">2FA activé</span>
                        <p class="font-medium">{{
                            selectedClient.twoFactorEnabled ? 'Oui' : 'Non'
                            }}</p>
                    </div>
                    <div *ngIf="selectedClient.twoFactorEnabled">
                        <span class="text-sm text-gray-500">Méthode 2FA</span>
                        <p class="font-medium">{{ selectedClient.twoFactorMethod
                            || 'Non spécifiée' }}</p>
                    </div>
                    <div *ngIf="selectedClient.stripeConnectId">
                        <span class="text-sm text-gray-500">Stripe Connect
                            ID</span>
                        <p class="font-medium">{{ selectedClient.stripeConnectId
                            }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-wrap justify-end mt-6 gap-3">
            <button (click)="confirmDeleteClient(selectedClient)"
                class="flex items-center text-red-600 hover:text-red-800 font-medium py-2 px-4 rounded-lg border border-red-200 hover:border-red-300 transition-colors">
                <i class="fas fa-trash mr-2"></i> Supprimer
            </button>
            <button (click)="openEditModal(selectedClient)"
                class="flex items-center bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                <i class="fas fa-pen mr-2"></i> Modifier
            </button>
            <button
                *ngIf="selectedClient.status !== 'active' && !(selectedClient.isActive === true && !selectedClient.status)"
                (click)="updateClientStatus(selectedClient, 'active')"
                class="flex items-center bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                <i class="fas fa-check mr-2"></i> Activer
            </button>
            <button *ngIf="selectedClient.status !== 'blocked'"
                (click)="updateClientStatus(selectedClient, 'blocked')"
                class="flex items-center bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                <i class="fas fa-ban mr-2"></i> Bloquer
            </button>
            <button (click)="verifyClient(selectedClient)"
                class="flex items-center bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                <i class="fas fa-user-check mr-2"></i> Vérifier
            </button>
            <button (click)="closeDetailsView()"
                class="flex items-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors">
                <i class="fas fa-times mr-2"></i> Fermer
            </button>
        </div>
    </div>

    <!-- Clients table -->
    <div
        *ngIf="!isLoading && !error && !isViewingDetails && getFilteredClients().length > 0"
        class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 uppercase text-sm">
                        <th class="py-3 px-4 text-left cursor-pointer"
                            (click)="sortClients('name')">
                            Nom <i class="fas"
                                [ngClass]="getSortIcon('name')"></i>
                        </th>
                        <th class="py-3 px-4 text-left cursor-pointer"
                            (click)="sortClients('city')">
                            Ville <i class="fas"
                                [ngClass]="getSortIcon('city')"></i>
                        </th>
                        <th class="py-3 px-4 text-left cursor-pointer"
                            (click)="sortClients('accountType')">
                            Type de compte <i class="fas"
                                [ngClass]="getSortIcon('accountType')"></i>
                        </th>
                        <th class="py-3 px-4 text-right cursor-pointer"
                            (click)="sortClients('balance')">
                            Solde <i class="fas"
                                [ngClass]="getSortIcon('balance')"></i>
                        </th>
                        <th class="py-3 px-4 text-center cursor-pointer"
                            (click)="sortClients('status')">
                            Statut <i class="fas"
                                [ngClass]="getSortIcon('status')"></i>
                        </th>
                        <th class="py-3 px-4 text-center cursor-pointer"
                            (click)="sortClients('dateJoined')">
                            Date d'inscription <i class="fas"
                                [ngClass]="getSortIcon('dateJoined')"></i>
                        </th>
                        <th class="py-3 px-4 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <tr *ngFor="let client of getPaginatedClients()"
                        class="hover:bg-gray-50">
                        <td class="py-3 px-4">
                            <div class="flex items-center">
                                <div
                                    class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-700 mr-3">
                                    {{ client.firstName?.[0] || '' }}{{
                                    client.lastName?.[0] || '' }}
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800">{{
                                        getFullName(client) }}</p>
                                    <p class="text-sm text-gray-500">{{
                                        client.email || 'Email non spécifié'
                                        }}</p>
                                </div>
                            </div>
                        </td>
                        <td class="py-3 px-4">{{ client.city || 'Non spécifiée'
                            }}</td>
                        <td class="py-3 px-4">{{ client.accountType ||
                            'Non spécifié' }}</td>
                        <td class="py-3 px-4 text-right">{{
                            formatCurrency(client.balance, client.currency)
                            }}</td>
                        <td class="py-3 px-4 text-center">
                            <span
                                [class]="'inline-block px-2 py-1 text-xs font-medium rounded-full ' + getStatusClass(client.status || (client.isActive ? 'active' : 'inactive'))">
                                {{ getStatusLabel(client.status ||
                                (client.isActive ? 'active' : 'inactive')) }}
                            </span>
                        </td>
                        <td class="py-3 px-4 text-center">
                            {{ (client.dateJoined || client.createdAt) ?
                            ((client.dateJoined || client.createdAt) |
                            date:'dd/MM/yyyy') :
                            'Non spécifiée' }}
                        </td>
                        <td class="py-3 px-4 text-center">
                            <div
                                class="flex items-center justify-center space-x-3">
                                <button (click)="viewClientDetails(client)"
                                    class="p-1.5 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 hover:text-blue-800 transition-colors"
                                    title="Voir les détails">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button (click)="openEditModal(client)"
                                    class="p-1.5 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 hover:text-gray-800 transition-colors"
                                    title="Modifier le client">
                                    <i class="fas fa-pen"></i>
                                </button>
                                <button (click)="confirmDeleteClient(client)"
                                    class="p-1.5 rounded-full bg-red-100 text-red-600 hover:bg-red-200 hover:text-red-800 transition-colors"
                                    title="Supprimer le client">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div
            class="px-4 py-3 border-t border-gray-200 flex items-center justify-between">
            <div class="text-sm text-gray-500">
                Affichage de {{ (currentPage - 1) * itemsPerPage + 1 }} à
                {{ Math.min(currentPage * itemsPerPage,
                getFilteredClients().length) }}
                sur {{ getFilteredClients().length }} clients
            </div>
            <div class="flex items-center space-x-2">
                <button [disabled]="currentPage === 1"
                    [class.opacity-50]="currentPage === 1"
                    (click)="prevPage()"
                    class="px-3 py-1 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors">
                    Précédent
                </button>
                <div
                    *ngFor="let page of [].constructor(totalPages); let i = index">
                    <button (click)="setPage(i + 1)"
                        [class]="currentPage === i + 1 ? 'bg-blue-50 text-blue-600 border-blue-300' : 'bg-white text-gray-600 border-gray-300'"
                        class="px-3 py-1 border rounded-lg transition-colors">
                        {{ i + 1 }}
                    </button>
                </div>
                <button [disabled]="currentPage === totalPages"
                    [class.opacity-50]="currentPage === totalPages"
                    (click)="nextPage()"
                    class="px-3 py-1 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors">
                    Suivant
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Client Modal -->
    <div *ngIf="showModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
        (click)="closeModal()"
        (keydown.escape)="closeModal()">
        <div
            class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"
            (click)="$event.stopPropagation()">
            <!-- Modal header -->
            <div
                class="border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-semibold text-gray-800">
                    {{ isEditing ? 'Modifier le client' : 'Ajouter un client' }}
                </h2>
                <button type="button" (click)="closeModal()"
                    class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Modal body -->
            <form [formGroup]="clientForm" (ngSubmit)="saveClient()"
                class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h3
                            class="text-lg font-medium text-gray-700 mb-2">Informations
                            personnelles</h3>

                        <!-- First Name -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Prénom
                                *</label>
                            <input type="text" formControlName="firstName"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('firstName')">
                            <p *ngIf="showValidationError('firstName')"
                                class="mt-1 text-sm text-red-500">
                                Le prénom est obligatoire
                            </p>
                        </div>

                        <!-- Last Name -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Nom
                                *</label>
                            <input type="text" formControlName="lastName"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('lastName')">
                            <p *ngIf="showValidationError('lastName')"
                                class="mt-1 text-sm text-red-500">
                                Le nom est obligatoire
                            </p>
                        </div>

                        <!-- Email -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Email
                                *</label>
                            <input type="email" formControlName="email"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('email')">
                            <p
                                *ngIf="showValidationError('email') && clientForm.get('email')?.errors?.['required']"
                                class="mt-1 text-sm text-red-500">
                                L'email est obligatoire
                            </p>
                            <p
                                *ngIf="showValidationError('email') && clientForm.get('email')?.errors?.['email']"
                                class="mt-1 text-sm text-red-500">
                                L'email n'est pas valide
                            </p>
                        </div>

                        <!-- Phone -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Téléphone
                                *</label>
                            <input type="tel" formControlName="phone"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('phone')">
                            <p *ngIf="showValidationError('phone')"
                                class="mt-1 text-sm text-red-500">
                                Le téléphone est obligatoire
                            </p>
                        </div>

                        <!-- Birth Date -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Date
                                de naissance *</label>
                            <input type="date" formControlName="birthDate"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('birthDate')">
                            <p *ngIf="showValidationError('birthDate')"
                                class="mt-1 text-sm text-red-500">
                                La date de naissance est obligatoire
                            </p>
                        </div>

                        <!-- Identity Type -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Type
                                d'identité *</label>
                            <select formControlName="identityType"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('identityType')">
                                <option value="CIN">CIN</option>
                                <option value="PASSPORT">Passeport</option>
                                <option value="SEJOUR">Carte de séjour</option>
                            </select>
                            <p *ngIf="showValidationError('identityType')"
                                class="mt-1 text-sm text-red-500">
                                Le type d'identité est obligatoire
                            </p>
                        </div>

                        <!-- Identity Number -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Numéro
                                d'identité *</label>
                            <input type="text" formControlName="identityNumber"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('identityNumber')">
                            <p *ngIf="showValidationError('identityNumber')"
                                class="mt-1 text-sm text-red-500">
                                Le numéro d'identité est obligatoire
                            </p>
                        </div>

                        <!-- Occupation -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Profession</label>
                            <input type="text" formControlName="occupation"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- Income -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Revenu
                                mensuel</label>
                            <input type="number" formControlName="income"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- Address and Account Information -->
                    <div class="space-y-4">
                        <h3
                            class="text-lg font-medium text-gray-700 mb-2">Adresse</h3>

                        <!-- Address -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Adresse
                                *</label>
                            <input type="text" formControlName="address"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('address')">
                            <p *ngIf="showValidationError('address')"
                                class="mt-1 text-sm text-red-500">
                                L'adresse est obligatoire
                            </p>
                        </div>

                        <!-- City -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Ville
                                *</label>
                            <select formControlName="city"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('city')">
                                <option *ngFor="let city of cities"
                                    [value]="city">{{city}}</option>
                            </select>
                            <p *ngIf="showValidationError('city')"
                                class="mt-1 text-sm text-red-500">
                                La ville est obligatoire
                            </p>
                        </div>

                        <!-- Postal Code -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Code
                                postal *</label>
                            <input type="text" formControlName="postalCode"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('postalCode')">
                            <p *ngIf="showValidationError('postalCode')"
                                class="mt-1 text-sm text-red-500">
                                Le code postal est obligatoire
                            </p>
                        </div>

                        <!-- Country -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Pays
                                *</label>
                            <input type="text" formControlName="country"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('country')">
                            <p *ngIf="showValidationError('country')"
                                class="mt-1 text-sm text-red-500">
                                Le pays est obligatoire
                            </p>
                        </div>

                        <h3
                            class="text-lg font-medium text-gray-700 mb-2 mt-6">Informations
                            du compte</h3>

                        <!-- Account Type -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Type
                                de compte *</label>
                            <select formControlName="accountType"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('accountType')">
                                <option *ngFor="let type of accountTypes"
                                    [value]="type">{{type}}</option>
                            </select>
                            <p *ngIf="showValidationError('accountType')"
                                class="mt-1 text-sm text-red-500">
                                Le type de compte est obligatoire
                            </p>
                        </div>

                        <!-- Currency -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Devise
                                *</label>
                            <select formControlName="currency"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('currency')">
                                <option *ngFor="let currency of currencies"
                                    [value]="currency">{{currency}}</option>
                            </select>
                            <p *ngIf="showValidationError('currency')"
                                class="mt-1 text-sm text-red-500">
                                La devise est obligatoire
                            </p>
                        </div>

                        <!-- Status -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Statut
                                *</label>
                            <select formControlName="status"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('status')">
                                <option value="active">Actif</option>
                                <option value="inactive">Inactif</option>
                                <option value="pending">En attente</option>
                                <option value="blocked">Bloqué</option>
                            </select>
                            <p *ngIf="showValidationError('status')"
                                class="mt-1 text-sm text-red-500">
                                Le statut est obligatoire
                            </p>
                        </div>

                        <!-- Language -->
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-1">Langue
                                *</label>
                            <select formControlName="language"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                [class.border-red-500]="showValidationError('language')">
                                <option value="fr">Français</option>
                                <option value="en">Anglais</option>
                                <option value="ar">Arabe</option>
                            </select>
                            <p *ngIf="showValidationError('language')"
                                class="mt-1 text-sm text-red-500">
                                La langue est obligatoire
                            </p>
                        </div>

                        <!-- GDPR Consent -->
                        <div class="flex items-center">
                            <input type="checkbox" id="gdprConsent"
                                formControlName="gdprConsent"
                                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <label for="gdprConsent"
                                class="ml-2 text-sm text-gray-700">
                                Accepte les conditions d'utilisation et la
                                politique de confidentialité
                            </label>
                        </div>

                        <!-- Password fields only for new clients -->
                        <div *ngIf="!isEditing" class="space-y-4 mt-4">
                            <h3 class="text-lg font-medium text-gray-700">Mot de
                                passe</h3>

                            <!-- Password -->
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-1">Mot
                                    de passe *</label>
                                <input type="password"
                                    formControlName="password"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    [class.border-red-500]="showValidationError('password')">
                                <p
                                    *ngIf="showValidationError('password') && clientForm.get('password')?.errors?.['required']"
                                    class="mt-1 text-sm text-red-500">
                                    Le mot de passe est obligatoire
                                </p>
                                <p
                                    *ngIf="showValidationError('password') && clientForm.get('password')?.errors?.['minlength']"
                                    class="mt-1 text-sm text-red-500">
                                    Le mot de passe doit contenir au moins 8
                                    caractères
                                </p>
                            </div>

                            <!-- Confirm Password -->
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-1">Confirmer
                                    le mot de passe *</label>
                                <input type="password"
                                    formControlName="confirmPassword"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    [class.border-red-500]="getPasswordMismatchError()">
                                <p *ngIf="getPasswordMismatchError()"
                                    class="mt-1 text-sm text-red-500">
                                    Les mots de passe ne correspondent pas
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="mt-8 flex justify-end space-x-4">
                    <button type="button" (click)="closeModal()"
                        class="flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-times mr-2"></i> Annuler
                    </button>
                    <button type="submit"
                        class="flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                        <i class="fas fa-save mr-2"></i>
                        {{ isEditing ? 'Mettre à jour' : 'Ajouter' }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete confirmation modal -->
    <div *ngIf="isDeleting && selectedClient"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
        (click)="cancelDelete()"
        (keydown.escape)="cancelDelete()">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6"
            (click)="$event.stopPropagation()">
            <div class="text-center mb-6">
                <i
                    class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Confirmer
                    la suppression</h2>
                <p class="text-gray-600">
                    Êtes-vous sûr de vouloir supprimer le client <strong>{{
                        getFullName(selectedClient) }}</strong> ?
                    Cette action est irréversible.
                </p>
            </div>
            <div class="flex justify-end space-x-3">
                <button (click)="cancelDelete()"
                    class="flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                    <i class="fas fa-times mr-2"></i> Annuler
                </button>
                <button (click)="deleteClient()"
                    class="flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                    <i class="fas fa-trash-alt mr-2"></i> Supprimer
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Ajouter à la fin du template -->
<div *ngIf="debugMode" class="fixed bottom-0 right-0 p-4 bg-white border shadow-lg rounded-lg m-4 max-w-lg max-h-96 overflow-auto z-50">
  <h3 class="font-medium mb-2">Données client:</h3>
  <pre class="text-xs">{{ selectedClient | json }}</pre>
  <button (click)="debugMode = false" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
    <i class="fas fa-times"></i>
  </button>
</div>

<button (click)="debugMode = !debugMode" 
        class="fixed bottom-4 right-4 bg-gray-800 text-white p-2 rounded-full z-50">
  <i class="fas fa-bug"></i>
</button>